<script>
  let currentNumber = 0;

  function getRange() {
    const rangeValue = document.getElementById("range").value;
    const [min, max] = rangeValue.split('-').map(Number);
    return { min, max };
  }

  function newQuestion() {
    const { min, max } = getRange();
    currentNumber = Math.floor(Math.random() * (max - min + 1)) + min;

    document.getElementById("answer").value = "";
    document.getElementById("feedback").innerText = "";

    playCurrent();
  }

  function playCurrent() {
    if (!currentNumber) return;

    const utterance = new SpeechSynthesisUtterance(currentNumber.toString());
    utterance.lang = 'ko-KR';

    const voices = speechSynthesis.getVoices();
    const koreanVoices = voices.filter(v => v.lang.includes('ko'));

    if (koreanVoices.length > 0) {
      utterance.voice = koreanVoices[0];
    } else {
      alert("⚠️ 此裝置可能沒有支援韓文語音。請在系統設定中安裝韓文語音包，或使用電腦瀏覽器。");
    }

    speechSynthesis.cancel();
    speechSynthesis.speak(utterance);
  }

  function checkAnswer() {
    const userAnswer = parseInt(document.getElementById("answer").value);
    const feedback = document.getElementById("feedback");

    if (isNaN(userAnswer)) {
      feedback.style.color = "orange";
      feedback.innerText = "⚠️ 請輸入數字";
      return;
    }

    if (userAnswer === currentNumber) {
      feedback.style.color = "green";
      feedback.innerText = `✅ 正確！答案是 ${currentNumber}`;
    } else {
      feedback.style.color = "red";
      feedback.innerText = `❌ 錯誤，正確答案是 ${currentNumber}`;
    }

    setTimeout(newQuestion, 1500);
  }

  document.getElementById("answer").addEventListener("keydown", function(event) {
    if (event.key === "Enter") {
      checkAnswer();
    }
  });

  // 等待語音加載後，再出題
  window.speechSynthesis.onvoiceschanged = () => {
    newQuestion();
  };
</script>
